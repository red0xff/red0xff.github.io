<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>NFSMW2012 : making opponents fly :: Redouane — Interesting stuff related to Computer Science, Gaming or Whatever</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="This is a gamehacking tutorial targeting Need for Speed Most Wanted 2012.

In this tutorial, I will register a hotkey that when pressed, will raise all the opponents by 20m to the sky (and by opponents I mean both cops and race opponents), lets start :D
We&amp;rsquo;ll start by searching for the z coordinate of our car (a value that indicates its height), we must keep in mind that the z axis might be inverted (ie."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://red0xff.github.io/posts/nfsmw2012_making_opponents_fly/" />

<link rel="stylesheet" href="https://red0xff.github.io/assets/reminder.css" />


<link rel="stylesheet" href="https://red0xff.github.io/assets/style.css">

  <link rel="stylesheet" href="https://red0xff.github.io/assets/blue.css">



<link rel="stylesheet" href="https://red0xff.github.io/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://red0xff.github.io/img/apple-touch-icon-144-precomposed.png">

<link rel="shortcut icon" href="https://red0xff.github.io/img/favicon/blue.png">



<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="NFSMW2012 : making opponents fly :: Redouane — Interesting stuff related to Computer Science, Gaming or Whatever" />
<meta name="twitter:description" content="This is a gamehacking tutorial targeting Need for Speed Most Wanted 2012.

In this tutorial, I will register a hotkey that when pressed, will raise all the opponents by 20m to the sky (and by opponents I mean both cops and race opponents), lets start :D
We&amp;rsquo;ll start by searching for the z coordinate of our car (a value that indicates its height), we must keep in mind that the z axis might be inverted (ie." />
<meta name="twitter:site" content="https://red0xff.github.io/" />
<meta name="twitter:creator" content="Redouane" />
<meta name="twitter:image" content="">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="NFSMW2012 : making opponents fly :: Redouane — Interesting stuff related to Computer Science, Gaming or Whatever">
<meta property="og:description" content="This is a gamehacking tutorial targeting Need for Speed Most Wanted 2012.

In this tutorial, I will register a hotkey that when pressed, will raise all the opponents by 20m to the sky (and by opponents I mean both cops and race opponents), lets start :D
We&amp;rsquo;ll start by searching for the z coordinate of our car (a value that indicates its height), we must keep in mind that the z axis might be inverted (ie." />
<meta property="og:url" content="https://red0xff.github.io/posts/nfsmw2012_making_opponents_fly/" />
<meta property="og:site_name" content="NFSMW2012 : making opponents fly" />
<meta property="og:image" content="">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2018-01-20 00:00:00 &#43;0200 &#43;0200" />











</head>
<body class="">


<div class="container center">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Redouane&#39;s Blog
  </div>
</a>
<div id="typingcode" class="hidden"></div>
<div id="fences"></div>


    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about/">About</a></li>
        
      
        
          <li><a href="/posts/">Posts</a></li>
        
      
        
          <li><a href="/search/">Search</a></li>
        
      
        
          <li><a href="/writeups/">Writeups</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about/">About</a></li>
      
    
      
        <li><a href="/posts/">Posts</a></li>
      
    
      
        <li><a href="/search/">Search</a></li>
      
    
      
        <li><a href="/writeups/">Writeups</a></li>
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://red0xff.github.io/posts/nfsmw2012_making_opponents_fly/">NFSMW2012 : making opponents fly</a></h1>
  <div class="post-meta">
    <span class="post-date">
      2018-01-20
    </span>
    
    <span class="post-author">::
      Redouane
    </span>
    
  </div>
  
  <span class="post-tags">
    
    #<a href="https://red0xff.github.io/tags/gamehacking/">gamehacking</a>&nbsp;
    
    #<a href="https://red0xff.github.io/tags/cheat-engine/">cheat engine</a>&nbsp;
    
    #<a href="https://red0xff.github.io/tags/reverse-engineering/">reverse engineering</a>&nbsp;
    
    #<a href="https://red0xff.github.io/tags/assembly/">assembly</a>&nbsp;
    
    #<a href="https://red0xff.github.io/tags/gaming/">gaming</a>&nbsp;
    
  </span>
  

  

  <div class="post-content">
    <p>This is a gamehacking tutorial targeting <code>Need for Speed Most Wanted 2012</code>.</p>
<p><a href="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110206/nfsmw2012_making_opponents_fly/gameplay_s4h3i4.png"><img src="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110206/nfsmw2012_making_opponents_fly/gameplay_s4h3i4.png" alt="Gameplay"></a></p>
<p>In this tutorial, I will register a hotkey that when pressed, will raise all the opponents by <code>20m</code> to the sky (and by opponents I mean both cops and race opponents), lets start :D</p>
<p>We&rsquo;ll start by searching for the <code>z</code> coordinate of our car (a value that indicates its height), we must keep in mind that the <code>z</code> axis might be inverted (ie. when our height increases, <code>z</code> might increase or decrease)</p>
<ul>
<li>
<p>This value has two possible types : Float and Double (because it&rsquo;s a real number)</p>
</li>
<li>
<p>There are two possible cases :</p>
<ul>
<li>Getting more height increases <code>z</code></li>
<li>It decreases <code>z</code></li>
</ul>
</li>
</ul>
<p>So there will be a total of <code>4</code> cases, we can use different tabs to speed up the process, but we&rsquo;ll start with the most likely (Float type, because FPU arithmetic is faster on single floats, game programmers like to use it for coordinates and values that are involved in lots of calculations)
Each time, we will start by scanning for an unknown initial value (because we don&rsquo;t know the initial <code>z</code> value).
Lets start with float, increasing value when we get more height:</p>
<p><a href="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110052/nfsmw2012_making_opponents_fly/unknown_initial_value_do81pz.png"><img src="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110052/nfsmw2012_making_opponents_fly/unknown_initial_value_do81pz.png" alt="209,290,240 results"></a></p>
<p><code>209,290,240</code> results, that&rsquo;s a lot! lets advance a little and rescan for decreased values, it will remove all the values that didn&rsquo;t decrease when we lost height.</p>
<p><a href="https://res.cloudinary.com/dik00g2mh/image/upload/v1558109735/nfsmw2012_making_opponents_fly/next1_u3aher.png"><img src="https://res.cloudinary.com/dik00g2mh/image/upload/v1558109735/nfsmw2012_making_opponents_fly/next1_u3aher.png" alt="2,516,010 results"></a></p>
<p><code>2,516,010</code> results, <code>99%</code> of the first scan results are already filtered out, let&rsquo;s keep filtering, let&rsquo;s get back up, and rescan for increased value, then rescan for unchanged values without moving (the <code>z</code> value shouldn&rsquo;t change if we stand in-place, we will rescan for unchanged while the game is paused)</p>
<p><a href="https://res.cloudinary.com/dik00g2mh/image/upload/v1558109749/nfsmw2012_making_opponents_fly/next2_tukc2u.png"><img src="https://res.cloudinary.com/dik00g2mh/image/upload/v1558109749/nfsmw2012_making_opponents_fly/next2_tukc2u.png" alt="584,104 results"></a></p>
<p><code>584,104</code> results
Let&rsquo;s drive to another place, of course <code>z</code> will change (changes that it will stay the same are very very low), so we scan for changed value (we don&rsquo;t know if it increased or decreased).</p>
<p><a href="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110155/nfsmw2012_making_opponents_fly/standing_znahnb.png"><img src="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110155/nfsmw2012_making_opponents_fly/standing_znahnb.png" alt="431,126 results"></a></p>
<p><code>431,126</code> results
We keep filtering this way, using the increased, decreased, changed, unchanged scan types, and we end up with <code>337</code> results</p>
<p><a href="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110135/nfsmw2012_making_opponents_fly/337_yomja6.png"><img src="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110135/nfsmw2012_making_opponents_fly/337_yomja6.png" alt="337 results"></a></p>
<p>Now that all the results look <more or less> related to the <code>z</code> coordinate of our car, let&rsquo;s start trying them one-by-one, each time, we incease the value, and we see if there is any change in the game, if there is none, we revert back our changes.
We select all the results, then click the red arrow next to the scan results, and we start testing them one by one.</p>
<p><a href="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110130/nfsmw2012_making_opponents_fly/found_z_pnfgq2.png"><img src="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110130/nfsmw2012_making_opponents_fly/found_z_pnfgq2.png" alt="z coordinate found"></a></p>
<p>We found it, address = <code>0AEA88B4</code> (it will change each time you restart the game/sometimes when you crash your car, or change it, because of Dynamic memory Allocation)</p>
<p>(Small note : coordinates are most of the time on the same structure, we found the address of the <code>z</code> coordinate of our car, we can easily find the other coordinates, the gravity that affects it, the rotation angles, the speed vector etc.)</p>
<p>Now that we found the address of our <code>z</code> coordinate, we will try to find out what accesses it (by putting an <code>on access</code> breakpoint on it), we will rightclick that entry, and choose <code>Find out what accesses this address</code></p>
<p><a href="https://res.cloudinary.com/dik00g2mh/image/upload/v1558109738/nfsmw2012_making_opponents_fly/read_breakpoint_xletmw.png"><img src="https://res.cloudinary.com/dik00g2mh/image/upload/v1558109738/nfsmw2012_making_opponents_fly/read_breakpoint_xletmw.png" alt="onread breakpoint"></a></p>
<p>There are a dozen instructions, most of them will probably access other variables (coordinates of other objects I guess), we will first try to find one instruction that only accesses this address, no others, to do that, we will add all the results to our codelist, then, we will test them one by one : select, then to find out what addresses they access, and check if there is only our car&rsquo;s structure (testing can take time, we must be sure)</p>
<p><a href="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110203/nfsmw2012_making_opponents_fly/accesses_only_mine_qhetvo.png"><img src="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110203/nfsmw2012_making_opponents_fly/accesses_only_mine_qhetvo.png" alt="Code accessing only my car coordinates"></a></p>
<p>Awesome, not only we found some code that accesses only the height of our car, but it also executes very often (it executes even when the game is paused), to keep track of our height (and avoing scanning for it in the future), we will do this:</p>
<ul>
<li>Inject some code using the found instruction as an injection point (remplace the instruction with a <code>jmp</code> to a codecave of ours, run our code there, run original code then return to where we left.</li>
<li>Our code will just save the address of the height of our car somewhere where we will find it easily (register a symbol), actually, instead of saving the height address, we will save the base address of the structure (<code>height address - 0x34</code>, which is the content of the <code>ecx</code> register)
The code will be simple, this will do:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#960050;background-color:#1e0010">[</span><span style="color:#a6e22e">enable</span>]
<span style="color:#a6e22e">alloc</span>(log_player,<span style="color:#ae81ff">1024</span>)
<span style="color:#a6e22e">label</span>(player_car) <span style="color:#f92672">//</span> player_car<span style="color:#f92672">+</span><span style="color:#ae81ff">30</span><span style="color:#960050;background-color:#1e0010">={</span>x,z,y<span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#a6e22e">registersymbol</span>(player_car)
<span style="color:#a6e22e">label</span>(returnlog)
log_player:
<span style="color:#a6e22e">mov</span> [player_car], ecx <span style="color:#f92672">//</span> save base of structure in the address player_car
<span style="color:#66d9ef">db</span> <span style="color:#ae81ff">0</span>f <span style="color:#ae81ff">28</span> <span style="color:#ae81ff">41</span> <span style="color:#ae81ff">30</span> <span style="color:#ae81ff">0</span>f <span style="color:#ae81ff">5</span>c <span style="color:#ae81ff">44</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">//</span> ORIGINAL CODE THAT WE PATCHED WITH A JMP
<span style="color:#a6e22e">jmp</span> returnlog  <span style="color:#f92672">//</span> return to where we left
player_car:
<span style="color:#66d9ef">dd</span> <span style="color:#ae81ff">0</span>   <span style="color:#f92672">//</span> initialize the content of player_car with <span style="color:#ae81ff">0</span>
<span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#a6e22e">NFS13.exe</span><span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>F7C65:
<span style="color:#a6e22e">jmp</span> log_player <span style="color:#f92672">//</span> jump to our allocated memory
<span style="color:#66d9ef">db</span> <span style="color:#ae81ff">90</span> <span style="color:#ae81ff">90</span> <span style="color:#ae81ff">90</span> <span style="color:#ae81ff">90</span> <span style="color:#f92672">//</span> FILL WITH NOPS
returnlog:
<span style="color:#960050;background-color:#1e0010">[</span><span style="color:#a6e22e">disable</span>]
<span style="color:#a6e22e">dealloc</span>(log_player)
<span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#a6e22e">NFS13.exe</span><span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>F7C65:
<span style="color:#66d9ef">db</span> <span style="color:#ae81ff">0</span>f <span style="color:#ae81ff">28</span> <span style="color:#ae81ff">41</span> <span style="color:#ae81ff">30</span> <span style="color:#ae81ff">0</span>f <span style="color:#ae81ff">5</span>c <span style="color:#ae81ff">44</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">60</span>
<span style="color:#a6e22e">unregistersymbol</span>(player_car)
</code></pre></div><p>When the box on the left of the script will be ticked, the code in <code>[enable]</code> will run, creating a symbol player_car that points to the address of the coordinates of our car, and when unticked, it will restore the original code.
We delete all the addresses from our address list, and we add that script (<code>CTRL+ALT+A</code>, paste the script, <code>File-&gt;Assign to current cheat table</code>)</p>
<p><a href="https://res.cloudinary.com/dik00g2mh/image/upload/v1558109771/nfsmw2012_making_opponents_fly/log_player_car_opxm2n.png"><img src="https://res.cloudinary.com/dik00g2mh/image/upload/v1558109771/nfsmw2012_making_opponents_fly/log_player_car_opxm2n.png" alt="Log Player Car"></a></p>
<p>We activate the script by ticking its box in the address list, then we click <code>add address manually</code>, we select Pointer, we enter <code>player_car</code> (it&rsquo;s the symbol that we registered, Cheat Engine will resolve it), and we set the offset to <code>0x34</code> (our height is at offset <code>0x34</code> in our structure)</p>
<p><a href="https://res.cloudinary.com/dik00g2mh/image/upload/v1558109701/nfsmw2012_making_opponents_fly/pointer_xnrrd1.png"><img src="https://res.cloudinary.com/dik00g2mh/image/upload/v1558109701/nfsmw2012_making_opponents_fly/pointer_xnrrd1.png" alt="Pointer"></a></p>
<p>Bingo, we got a pointer to our car height, we will never have to scan for it again.</p>
<p>We can even assign a hotkey that will increase the height of our car by a constant (rightclick on it <code>-&gt; Set/Change Hotkeys</code>).</p>
<p>Now we will try to find some code that accesses the structures of the opponents (cops and race opponents), if we find some code that does not access our car&rsquo;s structure, it will be better (code injection would not affect our car), but such a code isn&rsquo;t required, any code that accesses our targeted opponents structures will do.</p>
<p>What to do now? two solutions are possible:</p>
<ul>
<li>
<p>To try to find a difference between the structure of our car and the other structures using the structure dissector (find a field that indicates that it&rsquo;s the player&rsquo;s car for example), then in our injected code, check the content of that field and if it&rsquo;s our car, don&rsquo;t do anything, otherwise increase <code>z</code> by a given height.</p>
</li>
<li>
<p>In the injected code, to compare the base address of the structure with the one that we saved when we logged the base address of our player car (<code>player_car</code> symbol), if it&rsquo;s equal, then it&rsquo;s our car, otherwise it&rsquo;s an opponent.</p>
</li>
</ul>
<p>I chose the second option, because the first one is not guaranteed to work.</p>
<p>Next step : find some code that accesses the cars that we want to affect (cops and race opponents), we will:</p>
<ul>
<li>find the height address of an opponents car by finding out what some of these instructions access.</li>
<li>find out what accesses the height of the opponents car, and check the results one by one.</li>
</ul>
<p><a href="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110156/nfsmw2012_making_opponents_fly/shared_code_r4dybe.png"><img src="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110156/nfsmw2012_making_opponents_fly/shared_code_r4dybe.png" alt="Shared Code"></a></p>
<p>The code at address <code>&quot;NFS13.exe&quot;+5903E6</code> looks perfect, as shown in the picture, three of the results are the base addresses of the cops cars, and the fourth one is the one of my car, we also tested it on race opponents, and it accessed them.</p>
<p><a href="https://res.cloudinary.com/dik00g2mh/image/upload/v1558109776/nfsmw2012_making_opponents_fly/disassembly_aoym2l.png"><img src="https://res.cloudinary.com/dik00g2mh/image/upload/v1558109776/nfsmw2012_making_opponents_fly/disassembly_aoym2l.png" alt="Disassembly"></a></p>
<p>Looking at that code, there are other advantages:</p>
<ul>
<li>
<p>The <code>jmp</code> to our codecave will take <code>5</code> bytes, so we will need to add <code>3</code> nops, and the patched instructions are not position-dependent like relative <code>jmps</code> etc.</p>
</li>
<li>
<p><code>ecx</code> and <code>edx</code> are overwritten just after that instruction, so we are free to use them in our code (without the need to <code>push</code>/<code>pop</code> them)</p>
</li>
<li>
<p>Our code will run for <code>5ms</code> each time a hotkey is pressed (I chose <code>E</code>), increasing the height of each car by <code>20m</code>, and adding it to an array, in order to keep track of it, let&rsquo;s write some pseudocode that will help us writing the final thing in assembly</p>
</li>
<li>
<p>The hotkey will just set <code>activated</code> to <code>1</code></p>
</li>
</ul>
<pre><code class="language-clike" data-lang="clike">[OUR VARIABLES]
activated = 0; // if set to 1, the cheat will run for 5ms

start_time = 0;
player_car; // base address of our car structure
carscount = 0;
cars[] // An array, almost a page of free memory, empty initially
[CODE THAT WILL RUN ON EACH CAR IN SIGHT (cops, race opponents, our car)]
if (activated == 1)
{
    time = getTickCount(); // get current process time in ms
    if (start_time == 0)
        start_time = time;
    if (time - start_time &lt;= 5)
    {
        // still active
        if (player_car != base_of_structure) // player_car is the base of the structure of our car
        {
            // it's an opponent's car
            found = 0
            for each car in cars
                if (car == base_of_structure) found = 1 // search for base_of_structure in the cars array
            if (found == 0)
            {
                // not found in cars array, it means that it's the first time we encounter that car
                base_of_structure.z += 20 // increase height by 20m
                cars[carscount] = base_of_structure // add it to cars array, to avoid increasing the height more than once on a 5ms interval
                carscount += 1
            }
        }
    }
    else
    {
        // more than 5 ms have passed, clean the cars array and set activated to 0
        activated = 0
        start_time = 0
        for i = 0 to carscount
            car[i] = 0
        carscount = 0
    }
}
</code></pre><p>By using meaningful label names, string instructions with prefixes (<code>repne scasd</code>, <code>rep stosd</code>), our code has remained short and readable.
Full code here</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#960050;background-color:#1e0010">[</span><span style="color:#a6e22e">enable</span>]
<span style="color:#a6e22e">assert</span>(player_car,<span style="color:#f92672">**</span>)
<span style="color:#a6e22e">alloc</span>(forall,<span style="color:#ae81ff">1024</span>)
<span style="color:#a6e22e">label</span>(start_time)
<span style="color:#a6e22e">label</span>(amount)
<span style="color:#a6e22e">label</span>(alreadystarted)
<span style="color:#a6e22e">label</span>(clean_and_skip)
<span style="color:#a6e22e">label</span>(carscount)
<span style="color:#a6e22e">label</span>(returnforall)
<span style="color:#a6e22e">label</span>(activated)
<span style="color:#a6e22e">registersymbol</span>(activated)
forall:
<span style="color:#a6e22e">cmp</span> <span style="color:#66d9ef">byte</span> ptr[activated], <span style="color:#ae81ff">0</span>
<span style="color:#a6e22e">jz</span> skip
<span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#a6e22e">ITS</span> ACTIVATED
<span style="color:#a6e22e">push</span> edi
<span style="color:#a6e22e">push</span> eax
<span style="color:#a6e22e">call</span> GetTickCount
<span style="color:#a6e22e">mov</span> ecx, [start_time]
<span style="color:#a6e22e">test</span> ecx, ecx
<span style="color:#a6e22e">jnz</span> alreadystarted
<span style="color:#a6e22e">mov</span> [start_time], eax
alreadystarted:
	<span style="color:#a6e22e">sub</span> eax,[start_time]
	<span style="color:#a6e22e">cmp</span> eax, <span style="color:#ae81ff">5</span>
	<span style="color:#a6e22e">pop</span> eax
	<span style="color:#a6e22e">jle</span> stillactive
	<span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#a6e22e">No</span> longer active, desactivate the cheat
	<span style="color:#a6e22e">mov</span> <span style="color:#66d9ef">byte</span> ptr[activated], <span style="color:#ae81ff">0</span>
	<span style="color:#a6e22e">mov</span> [start_time], <span style="color:#ae81ff">0</span>
	<span style="color:#960050;background-color:#1e0010">//</span><span style="color:#a6e22e">CLEAN</span> ARRAY
	<span style="color:#a6e22e">mov</span> ecx, [carscount]
	<span style="color:#a6e22e">lea</span> edi, [cars]
	<span style="color:#a6e22e">push</span> eax
	<span style="color:#a6e22e">xor</span> eax, eax
	<span style="color:#a6e22e">rep</span> stosd
	<span style="color:#a6e22e">mov</span> [carscount],<span style="color:#ae81ff">0</span>
	<span style="color:#a6e22e">pop</span> eax
	<span style="color:#a6e22e">jmp</span> clean_and_skip
stillactive:
	<span style="color:#a6e22e">mov</span> edi,[player_car]
	<span style="color:#a6e22e">cmp</span> edi, eax
	<span style="color:#a6e22e">jz</span> clean_and_skip
	<span style="color:#a6e22e">lea</span> edi, [cars]
	<span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#a6e22e">SEARCH</span> FOR eax IN cars ARRAY
	<span style="color:#a6e22e">mov</span> ecx, [carscount]
	<span style="color:#a6e22e">repne</span> scasd
	<span style="color:#a6e22e">jz</span> clean_and_skip
	<span style="color:#960050;background-color:#1e0010">//</span><span style="color:#a6e22e">NOT</span> FOUND IN ARRAY, AND NOT MY CAR
	<span style="color:#a6e22e">mov</span> [edi], eax <span style="color:#f92672">//</span> INSERT IN ARRAY
	<span style="color:#a6e22e">inc</span> [carscount]
	<span style="color:#960050;background-color:#1e0010">//</span> <span style="color:#a6e22e">MAKE</span> IT FLY
	<span style="color:#a6e22e">fld</span> [eax<span style="color:#f92672">+</span><span style="color:#ae81ff">34</span>]
	<span style="color:#a6e22e">fadd</span> [amount]
	<span style="color:#a6e22e">fstp</span> [eax<span style="color:#f92672">+</span><span style="color:#ae81ff">34</span>]

clean_and_skip:
<span style="color:#a6e22e">pop</span> edi
skip:
<span style="color:#66d9ef">db</span> <span style="color:#ae81ff">0</span>f <span style="color:#ae81ff">28</span> <span style="color:#ae81ff">40</span> <span style="color:#ae81ff">30</span> <span style="color:#ae81ff">8</span>b <span style="color:#ae81ff">44</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">04</span>
<span style="color:#a6e22e">jmp</span> returnforall

activated:
<span style="color:#66d9ef">db</span> <span style="color:#ae81ff">0</span>
start_time:
<span style="color:#66d9ef">dd</span> <span style="color:#ae81ff">0</span>
amount:
<span style="color:#66d9ef">dd</span> (float)<span style="color:#ae81ff">20.0</span>
carscount:
<span style="color:#66d9ef">dd</span> <span style="color:#ae81ff">0</span>
cars:
<span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#a6e22e">NFS13.exe</span><span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#f92672">+</span><span style="color:#ae81ff">5903</span>E6:
<span style="color:#a6e22e">jmp</span> forall
<span style="color:#66d9ef">db</span> <span style="color:#ae81ff">90</span> <span style="color:#ae81ff">90</span> <span style="color:#ae81ff">90</span>
returnforall:
<span style="color:#960050;background-color:#1e0010">[</span><span style="color:#a6e22e">disable</span>]
<span style="color:#a6e22e">dealloc</span>(forall)
<span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#a6e22e">NFS13.exe</span><span style="color:#960050;background-color:#1e0010">&#34;</span><span style="color:#f92672">+</span><span style="color:#ae81ff">5903</span>E6:
<span style="color:#66d9ef">db</span> <span style="color:#ae81ff">0</span>f <span style="color:#ae81ff">28</span> <span style="color:#ae81ff">40</span> <span style="color:#ae81ff">30</span> <span style="color:#ae81ff">8</span>b <span style="color:#ae81ff">44</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">04</span>
<span style="color:#a6e22e">unregistersymbol</span>(activated)
</code></pre></div><p>In its <code>[disable]</code> section, we will just dealloc our allocated memory, and we&rsquo;ll restore the original code, now we&rsquo;ll add the script to our cheat table.
In order to activate the script, we need to set <code>activated</code> to <code>1</code>, this small Lua script will create the hotkey <code>E</code>, that when clicked, sets <code>activated</code> to <code>1</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lua" data-lang="lua">copsfly <span style="color:#f92672">=</span> createHotkey(<span style="color:#66d9ef">function</span>()
  <span style="color:#66d9ef">return</span> writeBytes(<span style="color:#e6db74">&#39;activated&#39;</span>, <span style="color:#ae81ff">1</span>)
<span style="color:#66d9ef">end</span>, VK_E)
</code></pre></div><p>We will save it on our cheat table (<code>table -&gt; Show Cheat Table Lua Script</code>).
Let&rsquo;s test it, and with different cars (to ensure that our cheat always works).</p>
<p><a href="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110198/nfsmw2012_making_opponents_fly/flying_cops_ebh69n.png"><img src="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110198/nfsmw2012_making_opponents_fly/flying_cops_ebh69n.png" alt="Flying Cops"></a></p>
<p>Cool, I can make cops fly :p
On race opponents :</p>
<p><a href="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110128/nfsmw2012_making_opponents_fly/flying_opponents_liagos.png"><img src="https://res.cloudinary.com/dik00g2mh/image/upload/v1558110128/nfsmw2012_making_opponents_fly/flying_opponents_liagos.png" alt="Flying Opponents"></a></p>
<p>It works!</p>
<p>(Note : addresses might differ on different game versions, I am using Black Box Repack version)</p>
<p>I hope you&rsquo;ve enjoyed the tutorial</p>
<p>Stay tuned for more!</p>

  </div>
  
  <div class="pagination">
    <div class="pagination__title">
      <span
        class="pagination__title-h">Read other posts</span>
      <hr />
    </div>
    <div class="pagination__buttons">
      
      <span class="button previous">
        <a href="https://red0xff.github.io/posts/when_exploit_mitigations_are_disabled_on_modern_systems/">
          <span class="button__icon">←</span>
          <span class="button__text">When exploit mitigations are disabled on modern systems</span>
        </a>
      </span>
      
      
    </div>
  </div>
  

  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "red0xff" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2020 Powered by <a href="http://gohugo.io">Hugo</a></span>
        <span>:: Proudly hosted on Github</span>
      </div>
    
  </div>
</footer>

<script src="https://red0xff.github.io/assets/main.js"></script>
<script src="https://red0xff.github.io/assets/prism.js"></script>
<script src="https://red0xff.github.io/assets/reminder.js"></script>
<script src="https://red0xff.github.io/assets/codetyper.js"></script>





  
</div>

</body>
</html>
